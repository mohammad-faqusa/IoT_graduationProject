<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Device Dashboard</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            padding: 2rem;
        }
        
        /* Container styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            margin-bottom: 2rem;
            color: #2d3748;
            text-align: center;
        }
        
        /* Device grid layout */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        /* Device card styles */
        .device-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .device-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .device-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid #edf2f7;
        }
        
        .device-info {
            padding: 1.5rem;
        }
        
        .device-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }
        
        .device-id {
            font-size: 0.875rem;
            color: #718096;
            margin-bottom: 1rem;
        }
        
        .device-status {
            display: flex;
            align-items: center;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online {
            background-color: #48bb78;
        }
        
        .status-offline {
            background-color: #f56565;
        }
        
        .status-text {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-online-text {
            color: #48bb78;
        }
        
        .status-offline-text {
            color: #f56565;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #edf2f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: #e53e3e;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #edf2f7;
            display: flex;
            justify-content: flex-end;
        }
        
        .modal-button {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .primary-button {
            background-color: #4299e1;
            color: white;
            border: none;
        }
        
        .primary-button:hover {
            background-color: #3182ce;
        }
        
        .secondary-button {
            background-color: transparent;
            color: #718096;
            border: 1px solid #cbd5e0;
            margin-right: 0.75rem;
        }
        
        .secondary-button:hover {
            background-color: #f7fafc;
        }
        
        /* Field styles */
        .field-item {
            padding: 0.75rem;
            background-color: #f7fafc;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        .field-label {
            font-size: 0.875rem;
            color: #718096;
            margin-bottom: 0.25rem;
        }
        
        .field-value {
            font-size: 1rem;
            font-weight: 500;
            color: #2d3748;
        }
        
        .field-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .device-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IoT Device Dashboard</h1>
        
        <div class="device-grid">
            <!-- Device cards will be dynamically added here -->
        </div>
    </div>
    <script src="socket.io/socket.io.js"></script>
    <script>
        /**
         * Modal class for creating and managing modal windows
         */
        class Modal {
            constructor(options = {}) {
                this.id = options.id || 'modal-' + Math.random().toString(36).substr(2, 9);
                this.title = options.title || 'Modal';
                this.content = options.content || '';
                this.buttons = options.buttons || [
                    { text: 'Close', type: 'secondary', id: 'close', handler: () => this.close() }
                ];
                this.onOpen = options.onOpen || (() => {});
                this.onClose = options.onClose || (() => {});
                this.element = null;
                this.overlay = null;
                this.isCreated = false;
                
                this.create();
                
                this.open = this.open.bind(this);
                this.close = this.close.bind(this);
                this.handleKeyDown = this.handleKeyDown.bind(this);
                this.handleOverlayClick = this.handleOverlayClick.bind(this);
            }
            
            create() {
                if (this.isCreated) return;
                
                this.overlay = document.createElement('div');
                this.overlay.className = 'modal-overlay';
                this.overlay.id = this.id + '-overlay';
                
                this.element = document.createElement('div');
                this.element.className = 'modal';
                this.element.setAttribute('role', 'dialog');
                this.element.setAttribute('aria-labelledby', this.id + '-title');
                this.element.setAttribute('aria-modal', 'true');
                
                const header = document.createElement('div');
                header.className = 'modal-header';
                
                const title = document.createElement('h2');
                title.className = 'modal-title';
                title.id = this.id + '-title';
                title.textContent = this.title;
                
                const closeButton = document.createElement('button');
                closeButton.className = 'modal-close';
                closeButton.setAttribute('aria-label', 'Close modal');
                closeButton.innerHTML = '&times;';
                closeButton.addEventListener('click', this.close);
                
                header.appendChild(title);
                header.appendChild(closeButton);
                
                const body = document.createElement('div');
                body.className = 'modal-body';
                
                if (typeof this.content === 'string') {
                    body.innerHTML = this.content;
                } else if (this.content instanceof HTMLElement) {
                    body.appendChild(this.content);
                }
                
                const footer = document.createElement('div');
                footer.className = 'modal-footer';
                
                this.buttons.forEach(button => {
                    const buttonElement = document.createElement('button');
                    buttonElement.className = `modal-button ${button.type}-button`;
                    buttonElement.id = button.id || button.text.toLowerCase().replace(/\s+/g, '-');
                    buttonElement.textContent = button.text;
                    
                    if (button.handler) {
                        buttonElement.addEventListener('click', button.handler);
                    }
                    
                    footer.appendChild(buttonElement);
                });
                
                this.element.appendChild(header);
                this.element.appendChild(body);
                this.element.appendChild(footer);
                this.overlay.appendChild(this.element);
                
                this.overlay.addEventListener('click', this.handleOverlayClick);
                
                document.body.appendChild(this.overlay);
                
                this.isCreated = true;
            }
            
            open() {
                if (!this.isCreated) {
                    this.create();
                }
                
                this.overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                document.addEventListener('keydown', this.handleKeyDown);
                
                setTimeout(() => {
                    const closeButton = this.element.querySelector('.modal-close');
                    if (closeButton) {
                        closeButton.focus();
                    }
                }, 100);
                
                if (typeof this.onOpen === 'function') {
                    this.onOpen();
                }
            }
            
            close() {
                this.overlay.classList.remove('active');
                document.body.style.overflow = '';
                document.removeEventListener('keydown', this.handleKeyDown);
                
                if (typeof this.onClose === 'function') {
                    this.onClose();
                }
            }
            
            handleKeyDown(event) {
                if (event.key === 'Escape') {
                    this.close();
                }
            }
            
            handleOverlayClick(event) {
                if (event.target === this.overlay) {
                    this.close();
                }
            }
            
            update(options = {}) {
                if (options.title) {
                    this.title = options.title;
                    const titleElement = this.element.querySelector('.modal-title');
                    if (titleElement) {
                        titleElement.textContent = this.title;
                    }
                }
                
                if (options.content) {
                    this.setContent(options.content);
                }
                
                if (options.buttons) {
                    this.buttons = options.buttons;
                    const footerElement = this.element.querySelector('.modal-footer');
                    if (footerElement) {
                        footerElement.innerHTML = '';
                        this.buttons.forEach(button => {
                            const buttonElement = document.createElement('button');
                            buttonElement.className = `modal-button ${button.type}-button`;
                            buttonElement.id = button.id || button.text.toLowerCase().replace(/\s+/g, '-');
                            buttonElement.textContent = button.text;
                            
                            if (button.handler) {
                                buttonElement.addEventListener('click', button.handler);
                            }
                            
                            footerElement.appendChild(buttonElement);
                        });
                    }
                }
                
                if (options.onOpen) {
                    this.onOpen = options.onOpen;
                }
                
                if (options.onClose) {
                    this.onClose = options.onClose;
                }
            }
            
            setContent(content) {
                this.content = content;
                const bodyElement = this.element.querySelector('.modal-body');
                if (bodyElement) {
                    bodyElement.innerHTML = '';
                    if (typeof content === 'string') {
                        bodyElement.innerHTML = content;
                    } else if (content instanceof HTMLElement) {
                        bodyElement.appendChild(content);
                    }
                }
            }
            
            destroy() {
                if (this.overlay) {
                    this.overlay.removeEventListener('click', this.handleOverlayClick);
                    document.removeEventListener('keydown', this.handleKeyDown);
                    document.body.removeChild(this.overlay);
                    this.isCreated = false;
                }
            }
        }
        
        /**
         * DynamicDeviceModal class
         * Handles device details with dynamic content
         */
        class DynamicDeviceModal extends Modal {
            constructor(options = {}) {
                const buttons = [
                    { 
                        text: 'Close', 
                        type: 'secondary', 
                        id: 'device-modal-close', 
                        handler: () => this.close() 
                    },
                    { 
                        text: 'Control Device', 
                        type: 'primary', 
                        id: 'device-modal-control', 
                
                        type: 'primary',
                        id: 'device-modal-control',
                        handler: () => this.controlDevice()
                    }
                ];
                
                super({
                    id: 'dynamic-device-modal',
                    title: options.title || 'Device Details',
                    content: '<div id="dynamic-device-content"></div>',
                    buttons: buttons,
                    onOpen: options.onOpen,
                    onClose: options.onClose
                });
                
                this.device = null;
            }
            
            showDevice(deviceData) {
                this.device = deviceData;
                
                this.update({ title: deviceData.name || 'Device Details' });
                
                const contentContainer = document.createElement('div');
                
                for (const [key, value] of Object.entries(deviceData)) {
                    const fieldElement = this.renderField(key, value);
                    if (fieldElement) {
                        contentContainer.appendChild(fieldElement);
                    }
                }
                
                this.setContent(contentContainer);
                
                const controlButton = document.getElementById('device-modal-control');
                if (controlButton) {
                    controlButton.textContent = deviceData.status === 'online' ? 'Control Device' : 'Restart Device';
                }
                
                this.open();
            }
            
            renderField(key, value) {
                const fieldElement = document.createElement('div');
                fieldElement.className = 'field-item';
                
                const label = document.createElement('div');
                label.className = 'field-label';
                label.textContent = this.formatLabel(key);
                
                const valueElement = document.createElement('div');
                valueElement.className = 'field-value';
                
                if (key === 'image' && typeof value === 'string') {
                    const img = document.createElement('img');
                    img.src = value;
                    img.alt = 'Device image';
                    img.className = 'field-image';
                    fieldElement.appendChild(img);
                } else if (key === 'status') {
                    const statusIndicator = document.createElement('span');
                    statusIndicator.className = `status-indicator status-${value.toLowerCase()}`;
                    
                    const statusText = document.createElement('span');
                    statusText.textContent = value;
                    statusText.className = `status-text status-${value.toLowerCase()}-text`;
                    
                    valueElement.appendChild(statusIndicator);
                    valueElement.appendChild(statusText);
                } else {
                    valueElement.textContent = value;
                }
                
                if (key !== 'image') {
                    fieldElement.appendChild(label);
                    fieldElement.appendChild(valueElement);
                }
                
                return fieldElement;
            }
            
            formatLabel(key) {
                return key.replace(/([A-Z])/g, ' $1')
                    .replace(/^./, str => str.toUpperCase())
                    .trim();
            }
            
            controlDevice() {
                if (!this.device) return;
                
                if (this.device.status === 'online') {
                    alert(`Opening control panel for ${this.device.name}`);
                } else {
                    alert(`Attempting to restart ${this.device.name}...`);
                }
            }
        }
        
        const socket = io(); 

        socket.on('connect', async ()=> {
            console.log('connected to the server')
            const devices2 = await socket.emitWithAck('fetchDevices', 'all')
            // const devices3 = devices2.map()
            
            // Sample device data
            const devices = [
                {
                    name: "Smart Thermostat",
                    id: "TH-2023-001",
                    type: "Thermostat",
                    status: "online",
                    image: "https://images.unsplash.com/photo-1558089687-f282ffcbc126?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                    location: "Living Room",
                    temperature: "72°F",
                    humidity: "45%",
                    mode: "Cooling",
                    targetTemperature: "70°F"
                },
                {
                    name: "Security Camera",
                    id: "SC-2023-042",
                    type: "Camera",
                    status: "offline",
                    image: "https://images.unsplash.com/photo-1557438159-51eec7a6c9e8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                    location: "Front Door",
                    resolution: "1080p",
                    nightVision: "Enabled",
                    motionDetection: "Active"
                },
                {
                    name: "Smart Light",
                    id: "SL-2023-107",
                    type: "Light",
                    status: "online",
                    image: "https://images.unsplash.com/photo-1546054454-aa26e2b734c7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                    location: "Bedroom",
                    brightness: "80%",
                    color: "Warm White",
                    powerUsage: "8.5W"
                },
                ...devices2.map(dev => dev.info)
            ];
            
            // Create device cards
            const deviceGrid = document.querySelector('.device-grid');
            devices.forEach(device => {
                const card = document.createElement('div');
                card.className = 'device-card';
                card.innerHTML = `
                    <img src="${device.image}" alt="${device.name}" class="device-image">
                    <div class="device-info">
                        <h2 class="device-name">${device.name}</h2>
                        <p class="device-id">ID: ${device.id}</p>
                        <div class="device-status">
                            <span class="status-indicator status-${device.status}"></span>
                            <span class="status-text status-${device.status}-text">${device.status}</span>
                        </div>
                    </div>
                `;
                deviceGrid.appendChild(card);
            });
            
            // Create a single instance of DynamicDeviceModal
            const deviceModal = new DynamicDeviceModal();
            
            // Add click event to each device card
            const deviceCards = document.querySelectorAll('.device-card');
            deviceCards.forEach((card, index) => {
                card.addEventListener('click', () => {
                    deviceModal.showDevice(devices[index]);
                });
            });
        })

        
    </script>
</body>
</html>